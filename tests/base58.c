#include <string.h>
#include <minunit.h>
#include <base58.h>


/* Test known base58 encodings */
START_TEST (test_base58encoding)
{
	uint8_t encoding[37] = {0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55};
	const uint8_t str1[] = {0x00,0xc4,0xc5,0xd7,0x91,0xfc,0xb4,0x65,0x4a,0x1e,0xf5,0xe0,0x3f,0xe0,0xad,0x3d,0x9c,0x59,0x8f,0x98,0x27,0x00,0x00,0x00,0x00};
	const uint8_t encoding1[] = "1JwSSubhmg6iPtRjtyqhUYYH7bZg1RstDD";
	const uint8_t str2[] = {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF};
	const uint8_t encoding2[] = "2n1XR4oJkmBdJMxhBGQGb96gQ88xUzxLFyG";
	const uint8_t str3[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
	const uint8_t encoding3[] = "1111111111111111111111111";	// TODO: Determine the correct encoding for 0x00.
	
	base58_encode (encoding, str1);
	mu_assert (memcmp (encoding, encoding1, sizeof(encoding1)) == 0, "base58_encode should correctly encode the test strings.");
	
	base58_encode (encoding, str2);
	mu_assert (memcmp (encoding, encoding2, sizeof(encoding2)) == 0, "base58_encode should correctly encode the test string of all 0xFF.");
	
	base58_encode (encoding, str3);
	mu_assert (memcmp (encoding, encoding3, sizeof(encoding2)) == 0, "base58_encode should correctly encode the test string of all 0x00.");
	
	mu_assert (encoding[36] == 0x55, "base58_encode should not write more than 36 bytes to the destination array.");
}
END_TEST

char *test_base58 (void)
{
	mu_run_test (test_base58encoding);
	
	return 0;
}
